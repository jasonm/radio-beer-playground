<h1 id="nfc-beer">nfc-beer</h1>

<p>Notes for the <code>nfc-beer</code> project.</p>

<h2 id="the-vision">The Vision</h2>

<p>Homebrew party.  200 people.  16 taps.  Everybody has a tasting glass and a smartphone.</p>

<p>Your tasting glass has an NFC tag in it.  Each tap has a proximity sensor + NFC controller.
When a bartender pours, the tap tells the system that Tap A poured Beer B into Cup C.</p>

<p>Then, you sync your glass with your smartphone via an app, and can not only see
which beers you drank but also a host of background information about the beers:
production details, pictures of the brewers picking out hops, temp and gravity during
fermentation.</p>

<p>(If your smartphone doesnt do NFC yet, dont sweat; the label has a QR code and/or
an alphanumeric shortcode you can fall back to.)</p>

<p>You can also find out where to buy them, or order a few bottles delivered to your home.</p>

<p>You can rate and keep notes, of course.  You can see who else has a similar taste profile.</p>

<p>A slick projected display behind the bar visualizes the popularity of each beer,
current estimated tap levels, other fun associations.</p>

<h2 id="the-core">The Core</h2>

<p>The core of this project is comprised of a few moving parts:</p>

<ul>
  <li>NFC labels + taps hardware system</li>
  <li>Data schema, repository, and API</li>
</ul>

<p>The higher-level features would be implemented as API clients on top of this;
say, an HTML5 mobile app for smartphone users and a separate D3.js-based
bar visualization.</p>

<h2 id="hardware-layer">Hardware layer</h2>

<p>NFC labels + controllers.</p>

<p>[ ] Select and vet hardware.
[ ] Is it better to use Pi + NFC breakout (adafruit 364) or Pi + Arduino shields?</p>

<ul>
  <li>Adafruit NFC/RFID on Raspberry Pi
    <ul>
      <li><a href="http://learn.adafruit.com/adafruit-nfc-rfid-on-raspberry-pi/overview">http://learn.adafruit.com/adafruit-nfc-rfid-on-raspberry-pi/overview</a></li>
    </ul>
  </li>
  <li>PN532 NFC/RFID controller breakout board - v1.3
    <ul>
      <li><a href="https://www.adafruit.com/products/364">https://www.adafruit.com/products/364</a></li>
    </ul>
  </li>
  <li>Adafruit PN532 NFC/RFID Controller Shield for Arduino + Extras
    <ul>
      <li><a href="http://www.adafruit.com/products/789">http://www.adafruit.com/products/789</a></li>
    </ul>
  </li>
  <li>Alternative NFC Arduino shield
    <ul>
      <li><a href="http://www.seeedstudio.com/depot/nfc-shield-p-916.html?cPath=132_134">http://www.seeedstudio.com/depot/nfc-shield-p-916.html?cPath=132_134</a></li>
    </ul>
  </li>
  <li>Possibly interface Pi with Arduino shield
    <ul>
      <li><a href="http://www.raspberrypi.org/archives/tag/arduino">http://www.raspberrypi.org/archives/tag/arduino</a></li>
      <li><a href="http://omer.me/2012/05/introducing-ponte/">http://omer.me/2012/05/introducing-ponte/</a></li>
      <li><a href="http://hackaday.com/2012/05/06/using-arduino-shields-with-the-raspberry-pi/">http://hackaday.com/2012/05/06/using-arduino-shields-with-the-raspberry-pi/</a></li>
    </ul>
  </li>
  <li>Possibly need to multiplex UART from Pi to NFC controllers
    <ul>
      <li><a href="http://raspberrypi.stackexchange.com/questions/3475/how-to-get-more-than-one-uart-interface">http://raspberrypi.stackexchange.com/questions/3475/how-to-get-more-than-one-uart-interface</a></li>
    </ul>
  </li>
  <li>NFC chip types
    <ul>
      <li><a href="http://www.gototags.com/docs/display/NFC/NFC+Chip+Types">http://www.gototags.com/docs/display/NFC/NFC+Chip+Types</a></li>
    </ul>
  </li>
  <li>Printed NFC stickers
    <ul>
      <li><a href="http://www.buynfctags.com/nfc-tags/stickers/custom-printed-nfc-sticker-ul.html">http://www.buynfctags.com/nfc-tags/stickers/custom-printed-nfc-sticker-ul.html</a></li>
      <li><a href="http://www.buynfctags.com/custom-printed-nfc-sticker-ntag203.html">http://www.buynfctags.com/custom-printed-nfc-sticker-ntag203.html</a></li>
    </ul>
  </li>
  <li>Other NFC retailers
    <ul>
      <li><a href="http://rapidnfc.com/">http://rapidnfc.com/</a></li>
    </ul>
  </li>
  <li>Tasting glasses
    <ul>
      <li><a href="http://beeradvocate.com/community/threads/4-oz-tasting-glasses-or-similar.14643/">http://beeradvocate.com/community/threads/4-oz-tasting-glasses-or-similar.14643/</a></li>
    </ul>
  </li>
</ul>

<p>USB-based readers:
* <a href="http://www.gototags.com/docs/display/NFC/NFC+Readers">http://www.gototags.com/docs/display/NFC/NFC+Readers</a>
* USB NFC read/write $45, or $40.50 in qty &gt; 10
  * <a href="http://www.buynfctags.com/nfc-readers-and-writers/acs-acr122u-nfc-usb-reader-and-writer.html">http://www.buynfctags.com/nfc-readers-and-writers/acs-acr122u-nfc-usb-reader-and-writer.html</a></p>

<p>Cost estimate for 1 installation, assume 16 taps, 200 attendees:</p>

<pre><code>Item                 Qty     Ea      Total
Raspberry Pi         1       35.00    35.00
USB Hub              1       10.00    10.00
NFC controller       16      39.00   624.00
Printed NFC sticker  200      1.12   224.00
Tasting glasses      200      1.80   360.00
-------------------------------------------
                     Grand total:   1244.00
               Cost per attendee:      6.22
</code></pre>

<p>Of course beer, taps, location, etc. are extra.</p>

<p>Another option instead of NFC is RFID.  NFC is two-way comm and read/write; but since
this is fundamentally an inventory tracking system (object tracking), RFID’s
read-only mode suffices.  NFC lets you store small amounts of data onto the tag,
and NFC-p2p mode lets peer devices communicate.  RFID is a passive, activated read
technology.</p>

<ul>
  <li>
    <p>EBay USD RFID readers are about $9 shipped.
<a href="http://www.ebay.com/itm/New-Black-Security-USB-RFID-ID-Proximity-Sensor-Smart-Card-Reader-125Khz-EM4100-/221046309121?pt=BI_Security_Fire_Protection&amp;hash=item3377630101">http://www.ebay.com/itm/New-Black-Security-USB-RFID-ID-Proximity-Sensor-Smart-Card-Reader-125Khz-EM4100-/221046309121?pt=BI_Security_Fire_Protection&amp;hash=item3377630101</a></p>

    <p>Item                 Qty     Ea      Total
  Raspberry Pi         1       35.00    35.00
  USB Hub              1       10.00    10.00
  RFID controller      16       9.00   144.00
  Printed RFID sticker 200      0.49    98.00
  Tasting glasses      200      1.80   360.00
  ——————————————-
                       Grand total:    647.00
                 Cost per attendee:      3.25</p>
  </li>
</ul>

<p>RFID cost, $0.50/ea in 500qty?
http://www.atlasrfidstore.com/Alien_Square_Wet_Inlay_WHITE_face_roll_of<em>500_p/aln-9662-fwrw</em>500.htm</p>

<h2 id="driver-layer">Driver layer</h2>

<p>The tap terminal machine will need drivers to receive NFC/RFID scans and
emit events upstream to the web software layer.</p>

<p>If we use NFC, the driver layer is ???</p>

<ul>
  <li>http://code.google.com/p/nfc-tools/</li>
</ul>

<p>If we use RFID, we receive 1 HID-keyboard device per reader which just types
a 10-digit code.  Can we demux these streams?</p>

<ul>
  <li><a href="http://stackoverflow.com/questions/8676135/osx-hid-filter-for-secondary-keyboard">http://stackoverflow.com/questions/8676135/osx-hid-filter-for-secondary-keyboard</a></li>
  <li>evdev on linux
    <ul>
      <li><a href="http://hewner.com/2006/08/21/evdev-for-ruby-with-morse-code/">evdev-ruby</a></li>
      <li><a href="http://stackoverflow.com/questions/5834220/how-to-read-out-an-usb-rfid-reader-imitating-an-hid-keyboard-using-linux-and-pyt">stackoverflow evdev question</a>
        <ul>
          <li><a href="http://128.130.182.59:8888/ceat/git/index.php?p=ceatclient.git&amp;a=blob&amp;h=d5be91bcf14cee983afdb03cfe8172b8984ac629&amp;hb=42b464b5a31541e77d9955940d408d1c4bb40f88&amp;f=evdev3.py">python evdev</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="web-software-layer">Web software layer</h2>

<p>Core entities:</p>

<ul>
  <li><code>beer</code>: an individual batch of brew</li>
  <li><code>vessel</code>: how do we subdivide this into bottle etc</li>
  <li><code>pour</code>: event</li>
  <li><code>tag</code>: physical nfc tag</li>
</ul>

<p>Pre-fill database with beers in vessels.
Smart taps publish <code>pour</code> events that link <code>beer</code> to a <code>tag</code>.</p>

<h2 id="api-clients">API clients</h2>

<ul>
  <li><em>Mobile web app</em> registers <code>tag</code> with a <code>user</code>, fetches contents via core api
and displays <code>beer</code> information based on that.</li>
  <li><em>Bar display</em> fetches information from core api like tallies of pours, synthesiszes it,
 and displays beautiful visualizations.</li>
</ul>

<h2 id="related-works">Related Works</h2>

<ul>
  <li>KegDroid—The Google-Powered Beer Tap
    <ul>
      <li><a href="http://gizmodo.com/5906483/kegdroidthe-google+powered-beer-tap">http://gizmodo.com/5906483/kegdroidthe-google+powered-beer-tap</a></li>
    </ul>
  </li>
  <li>Flow sensor to Untappd
    <ul>
      <li><a href="http://hackaday.com/2012/07/18/kegerator-tallies-your-pints-on-untappd-while-you-sit-back-with-a-cold-one/">http://hackaday.com/2012/07/18/kegerator-tallies-your-pints-on-untappd-while-you-sit-back-with-a-cold-one/</a></li>
    </ul>
  </li>
  <li>tokyohackerspace beer tap + rfid suggestion
    <ul>
      <li><a href="https://groups.google.com/forum/#!msg/tokyohackerspace/-sKrUmhuJpc/vP5E0tX6SNYJ">https://groups.google.com/forum/#!msg/tokyohackerspace/-sKrUmhuJpc/vP5E0tX6SNYJ</a></li>
    </ul>
  </li>
</ul>
